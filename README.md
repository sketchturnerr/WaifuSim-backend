# WaifuSim-backend
## Как развернуть
`docker-compose up -d` - запуск в демон-режиме.

`docker-compose -f docker-compose-testing.yml up` - запустить тесты.

Если поменялась структура базы, то перед этим нужно удалить контейнеры `docker-compose -f docker-compose-testing.yml rm -f` потом придумаю, как без этого обойтись.
## Api

### [Формат ошибок](#errors-format)

`{"title": <код ошибки>, "description": <человекопонятное описание>, "link": <ссылка на эту документацию>}`

### [Юзеры](#users)

`POST:/users` - cоздаст пользователя, в ответ вернет `{"token": <token>}`, его нужно сохранить на устройстве и использоватьзовать для всех остальных запросав к api, см. [тут](#auth).

`POST:/users?cookies=1` - не только создаст, но и сразу поставит авторизационную куку (актуально для web-клиента).

### [Автроризация](#auth)

Запросы к api должны либо соделжать query-пареметр `token=<token>`, либо иметь аналогичную куку.

`POST:/users/auth` - автоирзует пользователя и поставит авторизационную куку.
Ошибки:
* `401` - токен не передан или некорректен.
* `404` - обращение к ресурсу на который на хватет прав.

### [Вайфу](#waifu)

`POST:/waifu` - Создаст вайфу, в body быть json `{"name": string, "description": string, "pic": string  - url картинки, загрузка пока не сделана}`
Вайфы создаются приватными, т.е. ее видет только автор, про шэринг см. [тут](#waifu-share)

`GET:/waifu/{id}` - Вернет вайфу

`PUT:/waifu/{id}` - Обновит вайфу, body должен быть такой же, как в `POST`-е. Обновить может только автор.

### [Соннекчиваем юзера и вайфу](#user-waifu)

`POST:/user/waifu` - Ассоциирует вайфу и юзера. Можно коннектится с публичной вайфу или с той, которую создал сам. В body должен быть json `{"id": int - id вайфу, с которой хотим дружить}`.

`GET:/user/waifu` - Вернет текущую вайфу юзера.

### [Шэринг](#waifu-share)

`POST:/waifu-share` - Разшарит вайфу. Если шарит модератор, то вайфу станет публичной, если просто юзер, то попадет на модерацию. В body должен быть json `{"id": int - id вайфу, которую шарим}`.
